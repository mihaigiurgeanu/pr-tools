#!/usr/bin/env python3

import git
import os
import sys

def main():
    repo = git.Repo('.')
    branch = sys.argv[1] if len(sys.argv) > 1 else repo.active_branch.name
    author = repo.config_reader().get_value('user', 'name')
    base = 'master'
    commits = list(repo.iter_commits(f'{base}..{branch}'))
    commit_list = '\n'.join([f'- {c.hexsha[:7]} {c.message.strip().splitlines()[0]}' for c in commits])
    diff_summary = repo.git.diff(base, branch, stat=True)
    md = f"""# PR Snapshot for {branch}

**Author:** {author}

## Commits

{commit_list}

## Diff Summary

```
{diff_summary}
```
"""
    output_dir = os.path.expanduser('~/pr-drafts')
    os.makedirs(output_dir, exist_ok=True)
    output_path = os.path.join(output_dir, f'{branch}.md')
    with open(output_path, 'w') as f:
        f.write(md)
    print(f'Snapshot written to {output_path}')

if __name__ == '__main__':
    main()
